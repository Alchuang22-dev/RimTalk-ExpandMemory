# ?? 调试预览器增强指南

## ? 新功能概述

调试预览器现在可以显示**完整的角色关键词提取过程**，让您清楚地看到系统是如何从角色信息中提取关键词的。

---

## ?? 新增显示内容

### 1. 关键词提取总览

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
?? 【关键词提取详情】
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

角色: Alice
上下文关键词: 0 个
角色关键词: 45 个
总关键词: 45 个
```

---

### 2. 分类显示关键词

#### ?? 名字关键词 (1个)
```
Alice
```

#### ?? 年龄关键词 (2个)
```
成人, adult
```

#### ? 性别关键词 (1个)
```
女性
```

#### ?? 种族关键词 (1个)
```
人类
```

#### ?? 特质关键词 (3个)
```
勤劳, 细心, 夜猫子
```

#### ??? 技能关键词 (5个)
```
建造, 烹饪, 射击, 医疗, 种植
```

#### ? 技能等级关键词 (4个)
```
专家, 精通, 熟练, 良好, 基础
```

#### ?? 健康状况关键词 (2个)
```
健康, 良好
```

#### ?? 关系网络关键词 (8个)
```
Bob, 丈夫, Charlie, 朋友, David, 同事, ...
```

#### ?? 背景故事关键词 (12个)
```
军事, 事工, 工程, 程师, 军事工程, 事工程, 工程师, ...
```

#### ?? 童年背景关键词 (6个)
```
殖民, 民地, 地儿, 儿童, 殖民地, 民地儿, ...
```

---

## ?? 如何使用

### 打开调试预览器

1. **Mod设置** → **RimTalk-ExpandMemory**
2. 点击 **"打开调试预览器"** 按钮
3. 选择一个殖民者
4. 点击 **"刷新预览"**

---

### 查看关键词提取

在预览器中向下滚动，找到 **"关键词提取详情"** 部分：

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
?? 【关键词提取详情】
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

角色: Alice
从角色信息中提取了 45 个关键词

【分类展示】

?? 名字 (1个): Alice

?? 年龄 (2个): 成人, adult

? 性别 (1个): 女性

?? 种族 (1个): 人类

?? 特质 (3个): 勤劳, 细心, 夜猫子

??? 技能 (5个): 建造, 烹饪, 射击, 医疗, 种植

? 等级 (4个): 专家, 精通, 良好, 基础

?? 健康 (2个): 健康, 良好

?? 关系 (8个): Bob, 丈夫, Charlie, 朋友, David, 同事, ...

?? 背景 (12个): 军事, 工程, 师, 军事工程, 工程师, ...

?? 童年 (6个): 殖民, 地, 儿童, 殖民地, ...
```

---

## ?? 实际案例

### 案例1：验证婴儿关键词

**场景**：设置常识 `[规则] 婴儿不会说话`，选择一个婴儿角色

**预览器显示**：
```
?? 【关键词提取详情】

角色: 小宝 (0.5岁)
从角色信息中提取了 8 个关键词

【分类展示】

?? 名字 (1个): 小宝

?? 年龄 (4个): 婴儿, 宝宝, 小宝, baby

? 性别 (1个): 男性

?? 种族 (1个): 人类
```

**常识匹配结果**：
```
[1] ?? 评分: 0.35
    标签: [规则]
    内容: "婴儿不会说话"
    匹配关键词: 婴儿
```

? **成功匹配！** 因为提取到了"婴儿"关键词

---

### 案例2：验证技能关键词

**场景**：设置常识 `[技能] 专家级建造者说话简洁务实`，选择建造15级的角色

**预览器显示**：
```
??? 技能 (12个): 建造, 烹饪, 射击, 医疗, 种植, ...

? 等级 (2个): 专家, 精通
```

**常识匹配结果**：
```
[1] ?? 评分: 0.42
    标签: [技能]
    内容: "专家级建造者说话简洁务实"
    匹配关键词: 建造, 专家
```

? **成功匹配！** 因为同时匹配到"建造"和"专家"

---

### 案例3：验证关系关键词

**场景**：设置常识 `[角色] Alice和Bob是夫妻`，选择Alice

**预览器显示**：
```
?? 关系 (8个): Bob, 丈夫, Charlie, 朋友, David, 同事, ...
```

**常识匹配结果**：
```
[1] ?? 评分: 0.28
    标签: [角色]
    内容: "Alice和Bob是夫妻"
    匹配关键词: Alice, Bob
```

? **成功匹配！** 因为匹配到Alice和Bob

---

## ?? 调试技巧

### 技巧1：检查关键词是否被提取

如果常识没有被注入，先检查关键词提取部分：

1. 打开预览器
2. 查看 **"关键词提取详情"**
3. 确认您的关键词是否在列表中

**示例**：
```
常识: [规则] 婴儿不会说话
关键词: 婴儿

检查: ?? 年龄 (4个): 婴儿, 宝宝, 小宝, baby
结果: ? 找到了"婴儿"
```

---

### 技巧2：分析匹配分数

预览器会显示每条常识的评分和匹配的关键词：

```
[1] ?? 评分: 0.35
    标签: [规则]
    重要性: 0.80
    内容: "婴儿不会说话"
    匹配关键词: 婴儿 ?
    
分析:
- Jaccard相似度: 1/12 = 0.083
- 标签匹配: 0.0
- 综合评分: (0.083 * 0.7 + 0.0 * 0.3) * 0.80 = 0.046
- ? 低于阈值0.10，不会被注入！
```

**解决方案**：
- 降低阈值: 0.10 → 0.04
- 或添加更多关键词: [规则] 婴儿不会说话 → 关键词: 婴儿, 宝宝, baby

---

### 技巧3：优化关键词匹配

如果常识评分太低，可以：

1. **添加同义词**
```
[规则] 婴儿不会说话，只能咿呀学语
关键词: 婴儿, 宝宝, baby, 小宝, 咿呀
```

2. **提高重要性**
```
重要性: 0.5 → 1.0
```

3. **降低阈值**
```
常识阈值: 0.10 → 0.05
```

---

## ?? 完整预览示例

```
XTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT[
U        RimTalk 调试预览器 - 完整分析                                  U
^TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTa

殖民者: Alice
时间: 第5天 下午3点
注入模式: 动态评分
配置: 最大记忆10条, 最大常识5条, 记忆阈值0.15, 常识阈值0.10

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
?? 【关键词提取详情】
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

角色: Alice
从上下文提取: 0 个关键词
从角色信息提取: 45 个关键词
总关键词: 45 个

【分类展示】

?? 名字关键词 (1个)
Alice

?? 年龄关键词 (2个)
成人, adult

? 性别关键词 (1个)
女性

?? 种族关键词 (1个)
人类

?? 特质关键词 (3个)
勤劳, 细心, 夜猫子

??? 技能关键词 (5个)
建造, 烹饪, 射击, 医疗, 种植

? 技能等级关键词 (4个)
专家, 精通, 良好, 基础

?? 健康状况关键词 (2个)
健康, 良好

?? 关系网络关键词 (8个)
Bob, 丈夫, Charlie, 朋友, David, 同事, Emily, 妹妹

?? 背景故事关键词 (12个)
军事, 事工, 工程, 程师, 军事工程, 事工程师, 工程师, 建筑, 筑设, 
设计, 防御, 工事

?? 童年背景关键词 (6个)
殖民, 民地, 地儿, 儿童, 殖民地, 民地儿童

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
?? 【常识库注入详细分析】
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

?? 动态评分选择了 3 条常识
?? 评分阈值: 0.10 (低于此分数不注入)

[1] ?? 评分: 0.35
    标签: [技能]
    重要性: 0.90
    内容: "专家级建造者说话简洁务实"
    匹配关键词: 建造, 专家

[2] ?? 评分: 0.28
    标签: [角色]
    重要性: 0.80
    内容: "Alice和Bob是夫妻，感情深厚"
    匹配关键词: Alice, Bob, 丈夫

[3] ?? 评分: 0.15
    标签: [性格]
    重要性: 0.70
    内容: "勤劳的人工作认真负责"
    匹配关键词: 勤劳

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
?? 【注入统计】
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

? 常识注入: 3 条
?? Token估算: ~52 tokens
?? 成本估算: ~$0.0016 (GPT-4)

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
感谢使用 RimTalk 调试预览器！
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

## ?? 高级应用

### 应用1：精准调试婴儿常识

**步骤**：
1. 创建或选择一个婴儿角色
2. 设置常识: `[规则] 婴儿不会说话，只能咿呀学语`
3. 打开预览器，查看关键词提取
4. 确认"婴儿"关键词被提取
5. 查看常识匹配分数
6. 根据分数调整阈值或重要性

---

### 应用2：验证技能匹配

**步骤**：
1. 选择一个高技能角色（如建造15级）
2. 设置常识: `[技能] 专家说话专业但谦虚`
3. 查看关键词提取中的"专家"关键词
4. 确认常识被正确匹配

---

### 应用3：优化关系常识

**步骤**：
1. 选择有配偶的角色
2. 设置常识: `[角色] {角色名}和{配偶名}是夫妻`
3. 查看关系网络关键词
4. 确认配偶名字被提取
5. 验证常识匹配成功

---

## ?? 关键词提取规则

### 提取内容

| 类别 | 内容 | 示例 |
|------|------|------|
| 名字 | 角色名字 | Alice, Bob |
| 年龄 | 年龄段+同义词 | 婴儿, 宝宝, baby |
| 性别 | 性别标签 | 男性, 女性 |
| 种族 | Def标签 | 人类 |
| 特质 | 所有特质 | 勤劳, 细心, 夜猫子 |
| 技能 | 技能名称 | 建造, 烹饪, 射击 |
| 等级 | 等级描述 | 专家, 精通, 熟练 |
| 健康 | 健康状况 | 健康, 受伤, 恢复中 |
| 关系 | 相关角色+关系类型 | Bob, 丈夫, Charlie, 朋友 |
| 背景 | 背景故事关键词 | 军事, 工程师 |
| 童年 | 童年背景关键词 | 殖民地, 儿童 |

---

### 特殊规则

#### 婴儿（<3岁）
```
自动添加: 婴儿, 宝宝, 小宝, baby
```

#### 儿童（3-13岁）
```
自动添加: 儿童, 小孩, 孩子, child
```

#### 青少年（13-18岁）
```
自动添加: 青少年, teenager
```

#### 成人（>18岁）
```
自动添加: 成人, adult
```

#### 技能等级
```
15+级: 专家, 精通
10+级: 熟练, 精通
6+级: 良好
3+级: 基础
```

---

## ?? 常见问题

### Q: 为什么常识没有被注入？

**A**: 检查三个方面：
1. **关键词是否提取？** → 查看"关键词提取详情"
2. **评分是否够高？** → 查看常识评分
3. **是否低于阈值？** → 降低阈值或提高重要性

---

### Q: 如何提高匹配成功率？

**A**: 三个方法：
1. **添加同义词** → 增加匹配机会
2. **提高重要性** → 提升评分
3. **降低阈值** → 放宽筛选条件

---

### Q: 关键词太多会影响性能吗？

**A**: 不会！
- 关键词提取在本地完成
- 只有匹配成功的常识才会注入
- Token消耗取决于注入的常识数量，不是关键词数量

---

## ?? 总结

**调试预览器现在可以：**
? 显示完整的关键词提取过程
? 分类展示10种角色信息
? 显示每条常识的匹配关键词
? 提供详细的评分分析
? 帮助您精准调试常识匹配

**使用预览器，您可以：**
? 验证婴儿等特殊角色的关键词
? 优化常识库的匹配率
? 理解评分算法的工作原理
? 快速定位匹配问题

---

**祝您调试愉快！** ??
